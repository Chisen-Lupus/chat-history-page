% main.tex
\documentclass[a4paper, 9pt, twoside]{article}
\usepackage[inner=0.2in, outer=0.2in, top=0.2in, bottom=0.6in]{geometry}
\geometry{papersize={99mm, 210mm}}        % 定义 DL 尺寸

% 字体设置

\usepackage[fontset=none]{ctex}

\setmainfont{NotoSans-VariableFont_wdth,wght.ttf}[
  Renderer=HarfBuzz,
  Path=fonts/, % 末尾保留斜杠
  UprightFeatures    = {Weight=400},  % Regular
  BoldFont           = {NotoSans-VariableFont_wdth,wght.ttf},
  BoldFeatures       = {Weight=700},  % Bold
  ItalicFont         = {NotoSans-Italic-VariableFont_wdth,wght.ttf},
  ItalicFeatures     = {Weight=400}, 
  BoldItalicFont     = {NotoSans-Italic-VariableFont_wdth,wght.ttf},
  BoldItalicFeatures = {Weight=700}
]

\setCJKmainfont{NotoSansSC-VariableFont_wght.ttf}[
  Renderer=HarfBuzz,
  Path=fonts/, % 末尾保留斜杠
  UprightFeatures    = {Weight=400},  % Regular
  BoldFont           = {NotoSansSC-VariableFont_wght.ttf},
  BoldFeatures       = {Weight=700},  % Bold
]

\usepackage{fontspec} % Enables font customization

\newfontfamily\emojifont{NotoColorEmoji-noflags.ttf}[
  Renderer=HarfBuzz,
  Path = fonts/, % 若字体放在 fonts/ 目录下，否则可省略
  UprightFeatures = {RawFeature={+colr;+emoji;palette=0}}, % 启用彩色渲染
  Extension = .ttf,
]

\newfontfamily\Cans{NotoSansCanadianAboriginal-VariableFont_wght.ttf}[
  Renderer=HarfBuzz,
  Path = fonts/,
  UprightFeatures = {Weight=400},
  BoldFont = {NotoSansCanadianAboriginal-VariableFont_wght.ttf},
  BoldFeatures = {Weight=700},
  Scale = MatchLowercase,
]

\newfontfamily\mathfont{NotoSansMath-Regular.ttf}[
  Renderer=HarfBuzz,
  Path = fonts/,
  Extension = .ttf,
]

% 标题设置

\usepackage{titlesec}

\titleformat{\section}
  {\vspace{-1.75ex}\centering\Large\bfseries}
  {}
  {0em}
  {}

\titleformat{name=\subsection,numberless}[block]%
  {% Format settings for subsection
    \needspace{2.5\baselineskip}%  <-- Ensures appropiate lines of space remain
    \vspace{-1.75ex}    % Original style
  }%
  {}             % No label
  {0em}          % No indentation
  {}             % Nothing before subsection title text
  [\hrule height 0.5pt \vspace{0ex}] % After subsection

% 目录设置

\usepackage{tocloft} % 控制目录样式

\renewcommand{\contentsname}{} % 清空目录标题
\setlength{\cftbeforetoctitleskip}{0pt} % 移除标题前的空白
\setlength{\cftaftertoctitleskip}{0pt}  % 移除标题后的空白
\setcounter{tocdepth}{1} % 显示到 \section 层级

% 超链接设置

\usepackage{hyperref}

\hypersetup{
    colorlinks=true, %set true if you want colored links
    linktoc=all,     %set to all if you want both sections and subsections linked
    linkcolor=black, %choose some color if you want links to stand out
}

% 聊天记录样式

\usepackage{chat-history}



% ===============正文===============

\begin{document}

% 定义参与者
\include{people}

% ===============封面===============

\pagenumbering{gobble} % 禁用页码

\begin{titlepage}
  \centering
  \vspace*{2cm}
  \begin{tikzpicture}[baseline=(current bounding box.north)]
    \clip (0,0) circle(2cm); % Clip the avatar image to a circle
    \node[anchor=center,inner sep=0pt,minimum size=1cm] (avatar) at (0,0)
    {\includegraphics[width=4cm,height=4cm,keepaspectratio]{avatar/group.jpg}};
  \end{tikzpicture}\\[1cm]
  {\Huge\bfseries ``弦狼实验室''}\\[0.5cm]
  {\Huge\bfseries 群年度冷笑话大全}

  \vfill
  \textperiodcentered~2025~\textperiodcentered \\
  {\small (截至\today)}
  % {\small (2024年全)}
\end{titlepage}

\pagenumbering{roman} % 页码重置为阿拉伯数字
\setcounter{page}{1}   % 从第1页开始编号

% ===============目录===============

\section{目录}
% NOTE: 为了将页数凑成4的倍数 目录可以隐藏
\tableofcontents % 添加目录

\newpage

% ===============前言===============

% 参与者头像合影
\include{avatars}

\newpage

% ===============正文===============

\pagenumbering{arabic} % 页码重置为阿拉伯数字
\setcounter{page}{1}   % 从第1页开始编号

% \include{2024}
\include{2025}

% ===============封底===============

\newpage
\pagenumbering{gobble} % Disable page numbering

% 空页 用于页数凑整
% \null
% \newpage

\null
\vfill

\begin{quote}
    \centering
    感谢各位群友贡献的聊天记录.
\end{quote}
\begin{quote}
    \centering
    本文由\LaTeX 编写. 访问 \input{ |git remote get-url origin} 获取本文的源代码. 
\end{quote}

\end{document}
